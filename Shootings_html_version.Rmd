---
title: "US Mass Shootings 1982 to 2019"
date: 06/06/2019
author: 
  - Nic Fox
  - Mark Goble (minor additions)
output: 
  html_document:
    toc: true # table of content true
    toc_depth: 2  # upto three depths of headings (specified by #, ## and ###)
    toc_float: true # table of contents is always visible, to the left of the document
    theme: united
css: "Shootings.css"
---

Updated to use "marks little helper" package including refactorer function

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r import_data, include=FALSE}
# MG: Updated package list as things like dplyr loaded with tidyverse
# not sure you explictly need magrittr as common pipe functions are included as part of dplyr etc. 
# also you might not need knitr?
# MG: Also took the liberty of using a package helper function which will load any missing packages and check that all packages are loaded before proceeding.

# this version requires pacman to load / install packages

pacman::p_load(tidyverse, operators, knitr, sf, usmap, waffle, treemapify, gganimate, 
       tweenr, gifski, png, viridis, rlang, lubridate)



```

```{r}
refactorer <- function(data_frame,
                       column,
                       level_vector,
                       label_vector,
                       other_label = "Unknown"){

  checkmate::assert_data_frame(data_frame)
  checkmate::assert_string(column)
  checkmate::assert_vector(level_vector)
  # check the two vectors are of the same length
  level_vector_len <- length(level_vector)
  checkmate::assert_vector(label_vector, len = level_vector_len)
  checkmate::assert_string(other_label)

  if(!column %in% colnames(data_frame)){
    stop(paste(column, "is not not a column in the data frame"))
  }


  level_vector <- tolower(level_vector)
  column_sym <- rlang::sym(column)
  # note the special syntax i.e. !!column_sum := ...
  # https://www.tidyverse.org/articles/2018/03/rlang-0.2.0/
  data_frame %>%
    dplyr::mutate(!!column_sym := trimws(!!column_sym)) %>% #get rid of whitespace...
    dplyr::mutate(!!column_sym := tolower(!!column_sym)) %>% # change to lower case for better comparisons..
    dplyr::mutate(!!column_sym := factor(!!column_sym,
                                  levels = level_vector,
                                  labels = label_vector)) %>%
    dplyr::mutate(!!column_sym := forcats::fct_explicit_na(!!column_sym,
                                           na_level =  other_label)) # use forcats to deal with unset levels...

}

```



```{r}
# MG: Split out the data load from package load - saves having to reload all the packages if you debug a faulty load...

# Import the shootings data from the CSV file and save it as a data frame called imported_data
imported_data <- read.csv("ShootingsData.csv", strip.white = TRUE)

# Create a copy of the data to change during cleansing, so that the original data is preserved
cleansed_data <- imported_data

# Create the colour palette for the data visualisations using the magma colour palette from the viridis package
colour_palette <- magma(101)

```


```{r cleanse_data, include=FALSE}

# Create new column containing 1 for each row, to use when showing number of shootings per grouping
cleansed_data <- cleansed_data %>%
  mutate(for_count = 1)
# Update the gender column so that there is only one version of "Female" etc

# MG using factor labels to deal with the different naming...
# MG also extracting the process of sorting out the factors into a function

# MG note don't need two levels for M and m for example as taken care of in function.
lvls_gender <- c("M", "Male", "F", "Female", "Male & Female")
lbls_gender <- c("Male", "Male", "Female", "Female", "Male & Female")

cleansed_data <- refactorer(cleansed_data, "gender", lvls_gender, lbls_gender, "Unknown")

rm(lvls_gender, lbls_gender)

#MG: sanity check - check all levels accounted for - should be 0
# NOT RUN
# sum(is.na(cleansed_data$gender)

# Update the race column so that there is only one version of Unknown, Black, White etc

lvls_race <- c("Black", "Latino", "Native American", "White", "Asian")
lbls_race <- c("Black", "Latino", "Native American", "White", "Asian")

cleansed_data <- refactorer(cleansed_data, "race", lvls_race, lbls_race,  "Unknown")

rm(lvls_race, lbls_race)

#MG: sanity check - check all levels accounted for - should be 0
# NOT RUN
# sum(is.na(cleansed_data$race))
# MG might also want to consider calling table to see the results for sainity checking...
#MG removed the handling code for Asian / residual NA as handled in the above factor code...

# Update the "Weapons Obtained Legally" column so that there is only one version of "Yes" etc

# Set weapons_obtained_legally to "Yes" for the Chattanooga military recruitment center shooting. The value in the imported data set contains quotes and I haven't figured out how to get the match condition to work with that value yet so this is a temporary workaround.

#MG moved to before the other processing so it's clean before going into the function also converted to tidyverse...

cleansed_data <- cleansed_data %>%
  mutate(weapons_obtained_legally = 
           ifelse(case == "Chattanooga military recruitment center",
                  "Yes",
                  weapons_obtained_legally))


lvls_weapons <- c("No","Yes")
lbls_weapons <- c("No","Yes")

cleansed_data <- refactorer(cleansed_data, "weapons_obtained_legally", lvls_weapons, lbls_weapons, "Unknown")

rm(lvls_weapons, lbls_weapons)

# Create a new column containing the text after the comma in the location column
# MG used a safer method (using imported data) to split and take the state and trim whitespace

#MG tidyverse way to split out the state. In this case ok to take from cleansed as leaving orginal column untouched...

cleansed_data <-cleansed_data %>%
  separate(location, c(NA, "state"), remove = FALSE, sep = ",") %>%
  mutate(state = str_squish(state)) # squish is like trimws but takes out multiple whitespace between words

# MG deal wiith washington D.C. and mis-spelt Louisiana..

cleansed_data <- cleansed_data %>%
  mutate(state = ifelse(state == "D.C.","WA", state)) %>%
  mutate(state = ifelse(state == "Lousiana","Louisiana", state)) 


# MG: there are precanned lists of states in the US Maps - create a levels of both full name and abbreviations
lvls_state <- c(state.name, state.abb)
lbls_state <- c(state.abb, state.abb)

cleansed_data <- refactorer(cleansed_data, "state", lvls_state, lbls_state, "Unknown")

rm(lvls_state, lbls_state)

# Strip leading white spaces from location.1 so that there's only one instance of "Workplace". # Strip trailing white spaces from location.1 so that there's only one instance of "Other"
# MG can do both cases with trimws <- didn't bother changing to tidyverse

cleansed_data$location.1 <- trimws(cleansed_data$location.1)

# Change "-", "TBD" and "Unclear" to "Unknown"
# MG same trick as above

lvls_health <- c("No", "Yes")
lbls_health <- c("No", "Yes")

cleansed_data <- refactorer(cleansed_data, "prior_signs_mental_health_issues", lvls_health, lbls_health, "Unknown")

rm(lvls_health, lbls_health)

# MG lubridate will radically reduce the processing needed to standardise the date
cleansed_data$international_date <- lubridate::mdy(cleansed_data$date)

#
```

# Data

This analysis is based on data on US mass shootings 1982 - 2019 provided by Mother Jones.

> ["Our research focused on indiscriminate rampages in public places resulting in four or more victims killed by the attacker. We exclude shootings stemming from more conventionally motivated crimes such as armed robbery or gang violence."](https://www.motherjones.com/politics/2012/07/mass-shootings-map/)

The download is available on [motherjones.com](https://www.motherjones.com/politics/2012/12/mass-shootings-mother-jones-full-data/)  

  
# Key Findings 

## Victims By State

```{r create_state_victims_summary, include=FALSE}

# Create a new data frame that shows number of victims by state

# tidyverse way to aggregate & tally victims..
victims_by_state <- cleansed_data %>%
  group_by(state) %>%
  tally(total_victims, name = "victims")

#MG - refactoring ends here!!!!!!

```


```{r display_plot_state_victims, echo=FALSE, fig.width=9, fig.height=7}

# Create a chart showing the states on a map of the US and shade the states by the number of victims
plot_state_map_victims <- plot_usmap(data = victims_by_state, values = "victims", regions = "states", labels = TRUE, label_color = "white") +
  scale_fill_continuous(low = colour_palette[50], high = colour_palette[20], na.value = "white", name = "victims") +
  theme(
    legend.position = "top", 
    legend.title = element_text(colour = "#666666", size = 16, vjust = 0.75),
    legend.text = element_text(colour = "#666666", size = 8),
    plot.margin=unit(c(1,0,1,0),"cm"))
  

# Display the map chart
plot_state_map_victims

```
**35** of the 50 states (**70%**) had at least one mass shooting between 1982 and 2019.    

**Nevada** has had the most victims from mass shootings, due to the 2017 Las Vegas Strip massacre in which there were **604** victims (546 injured, and 58 killed). 
  
  
## Shootings By State

```{r create_state_summary, include=FALSE}

# Create a new data frame that shows number of shootings by state
shootings_per_state <- data.frame(table(cleansed_data$state))

# Change the column heading names to "state" and "shootings"
colnames(shootings_per_state) <- c("state", "shootings")

```


```{r display_plot_state, echo=FALSE, fig.width=10, fig.height=5}

# Create a treemap chart of the shootings per state
treemap_state_shootings <- ggplot(shootings_per_state, aes(area = shootings, label = state)) +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16))+
  geom_treemap(aes(alpha = shootings), fill = colour_palette[20]) +
  geom_treemap_text(colour = "white", place = "centre",
                    grow = TRUE)

# Display the treemap chart of shootings per state
treemap_state_shootings

```  


**California** has had the most mass shootings (**19**). 
    
    
## Shootings By Gender

```{r create_gender_summary, include=FALSE}

# Create a new data frame that shows number of shootings per gender
shootings_per_gender <- data.frame(table(cleansed_data$gender))

# Change the column heading names to "gender" and "shootings"
colnames(shootings_per_gender) <- c("gender", "shootings")
```

### 96%

of mass shooters were **men**
  
  
## Shootings By Year

```{r create_year_summary, include=FALSE}

# Create a new data frame that shows number of shootings per year
shootings_per_year <- data.frame(table(cleansed_data$year))

# Change the column heading names to "year" and "shootings"
colnames(shootings_per_year) <- c("year", "shootings")
```


```{r display_plot_year, echo=FALSE, fig.height=5, fig.width=10}

# Create a line graph showing the number of mass shootings per year
my_line_plot <- ggplot(data=shootings_per_year, aes(x=year, y=shootings, group=1)) +
  geom_line(color="#FB825F", size = 2)+
  geom_point(color="#FB825F")+
  labs(x = "Year",
       y = "Number of mass shootings")+
  geom_text(data=subset(shootings_per_year, year == "1984" | year == "1989"  | year == "1991"| year == "1993" | year == "1999" | year == "2012" | year == "2017" | year == "2018"), aes(label=shootings), vjust = -1, size = 6, col = "#666666", fontface = "bold")+
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 18, angle = 90, vjust = 0.5),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 18),
    axis.title.x = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    axis.line.y = element_line(colour = "#666666"),
    panel.background = element_blank(), # Remove the grey background
    panel.grid.major = element_line(colour = "#e0e0e0"), # Add the major grid lines back in
    panel.grid.minor = element_line(colour = "#e0e0e0"), # Add the minor grid lines back in
    plot.margin=unit(c(1,0,1,0),"cm"))+
  geom_smooth(method = "loess", colour = "#666666", linetype = 2, size = 0.5 )+
  coord_cartesian(ylim=c(0,15))

# Display the line plot
my_line_plot

```

The number of mass shootings per year in the US is **increasing**.  

The year with the most shootings was **2018** which consisted of **11%** of the mass shootings.
  
  
## Shootings Per State Over Time

```{r create_year_state_summary, include=FALSE}

# Create a new data frame that shows number of shootings per year per state
shootings_per_year_state <- aggregate(cleansed_data$for_count, by=list(cleansed_data$year, cleansed_data$state),FUN = sum)

# Change the column heading names to "year", "state", "shootings"
colnames(shootings_per_year_state) <- c("year", "state", "shootings")

```


```{r animated_plot, echo=FALSE, fig.height=7, fig.width=10}

animated_plot <- ggplot(data = shootings_per_year_state, aes(x = state, y = shootings, fill = state)) +
  geom_col()+
  scale_fill_viridis_d(aesthetics = "fill", option = "A", direction = 1, begin = 0.2, end = 1)+
  theme(legend.position = "none",
        axis.ticks = element_blank(),
        axis.text = element_text(colour = "#666666", size = 8, angle = 90, vjust = 0.5),
        axis.title = element_text(colour = "#666666", size = 16),
        plot.title = element_text(colour = "#666666", size = 18),
        panel.background = element_blank(), # Remove the grey background
        panel.grid.major = element_line(colour = "#e0e0e0"), # Add the major grid lines back in
        panel.grid.minor = element_line(colour = "#e0e0e0"), # Add the minor grid lines back in)
        plot.margin=unit(c(1,0,1,0),"cm"))+ 
  # The gganimate specific bits:
  labs(title = "Year: {frame_time}", x = "", y = "Number of Mass Shootings") +
  transition_time(year) +
  ease_aes('linear')+
  enter_grow()+
  exit_shrink()

# Display the animated plot and set the duration
animated_shootings_gif <- animate(animated_plot, duration = 20)

# Display the animated plot
animated_shootings_gif

# Save the animation as a gif
# anim_save('animated_shootings.gif', animation = animated_shootings_gif) # This saves a file but its a bunch of static frames rather than an animated gif. Need to look into this.

```
  
  
## Shootings By Decade

```{r create_decade_column, include=FALSE}

# Create a new column called decade and populate it with the decade of each shooting 

cleansed_data$decade <- case_when(
    cleansed_data$year < "1990" ~ "1980-1989",
    cleansed_data$year > "1989" & cleansed_data$year < "2000" ~"1990-1999",
    cleansed_data$year > "1999" & cleansed_data$year < "2010" ~"2000-2009",
    cleansed_data$year > "2009" & cleansed_data$year < "2020" ~"2010-2019"
)

```

```{r create_decade_summary, include=FALSE}

# Create a new data frame that shows number of shootings per decade
shootings_per_decade <- data.frame(table(cleansed_data$decade))

# Change the column heading names to "decade" and "shootings"
colnames(shootings_per_decade) <- c("decade", "shootings")
```

```{r display_plot_decade, echo=FALSE, fig.height=5, fig.width=10}

# Create a bar chart using ggplot2 to show shootings by decade
plot_decade <- ggplot(shootings_per_decade, aes(y=shootings, x=decade)) + 
  geom_bar(position="dodge", stat="identity", fill = colour_palette[47]) +
  labs(x = "Decade",
       y = "Number of mass shootings") +
  geom_text(aes(label=shootings), vjust = -0.5, size = 8, col = "#666666", fontface = "bold") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 22),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 18),
    axis.title.x = element_blank(), 
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm")) +
    coord_cartesian(ylim=c(0,70))

# Display the chart 
plot_decade

```

The number of mass shootings this decade is almost **triple** the number in the previous decade.
  
  
## Shootings By Race

```{r create_race_summary, include=FALSE}

# Create a new data frame that shows number of shootings per race
shootings_per_race <- data.frame(table(cleansed_data$race))

# Change the column heading names to "race" and "shootings"
colnames(shootings_per_race) <- c("race", "shootings")
```

```{r display_plot_race, echo=FALSE, fig.width=10, fig.height=5}

# Create a lollipop chart using ggplot2 to show number of shootings per race
lollipop_race <- ggplot(shootings_per_race, aes(y=shootings, x=reorder(race, -shootings))) +
  geom_segment( aes(x = race, xend=race, y=0, yend=shootings), 
                color = "#e0e1e2", 
                size = 2) +
  geom_point( size=15, 
              color=colour_palette[20], 
              fill=colour_palette[20], 
              shape=21
              ) +
  labs(y = "Number of mass shootings") +
  geom_text(aes(label=shootings),hjust=0.5, vjust=0.5, color = "#FFFFFF", size = 9) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 14),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 18),
    axis.title.x = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
    coord_cartesian(ylim=c(0,70))

# Display the chart
lollipop_race

```

**More than half** (56%) of mass shooters were **white**.
  
    
    
## Prior Signs of Mental Health Issues

```{r create_prior_summary, include=FALSE}

# Create a new data frame that shows number of shootings per race
shootings_per_prior <- data.frame(table(cleansed_data$prior_signs_mental_health_issues))

# Change the column heading names to "prior_signs_of_mental_health_issues" and "shootings"
colnames(shootings_per_prior) <- c("prior_signs_of_MH_issues", "shootings")
```

```{r display_plot_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a treemap chart 
treemap_prior_shootings <- ggplot(shootings_per_prior, aes(area = shootings, label = prior_signs_of_MH_issues)) +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16))+
  geom_treemap(aes(alpha = shootings), fill = "#e1ad46") +
  geom_treemap_text(colour = "white", place = "centre",
                    grow = TRUE)

# Display the treemap chart 
treemap_prior_shootings

```

**More than half** (53%) of mass shooters had **prior signs** of mental health issues.

Arkansas is the only state where none of their shooters had prior signs of mental health issues, but Arkansas has only had **1** mass shooting and the shooter was only **11 years old**. 
    
      
        
        
## State & Prior Signs of Mental Health Issues

```{r create_state_prior_summary, include=FALSE}
# Create a new data frame that shows number by state and whether there were prior signs of mental health issues
shootings_per_state_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to State, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_state_prior) <- c("State", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_state_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by state and whether there were prior signs of mental health issues
 plot_state_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=State, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_state_prior, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[60], colour_palette[80], colour_palette[97])) +
  labs(x = "State",
       y = "% of mass shootings",
       fill = "Prior Signs of Mental Health Issues?") +
  theme(
    legend.position = "top",
     legend.title = element_text(colour = "#666666", size = 16, vjust = 0.75),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))  

# Display the bar chart 
plot_state_prior

# Create a heatmap showing the number of mass shootings per state and whether there were prior signs of mental health issues
heatmap_state_prior <- ggplot(shootings_per_state_prior, aes(Prior_Signs_Of_Mental_Health_Issues, State)) + 
  geom_tile(aes(fill = Num_Shootings), colour = "white") + 
  scale_fill_gradient(low = "#e892c3", high = "#a51c6a")+
  geom_text(aes(label=Num_Shootings), hjust=0.5, vjust=0.5, color = "#FFFFFF", size = 4) +
  labs(x = "Prior Signs of Mental Health Issues", fill = "Number of Shootings")+
  theme(
    legend.position = "top",
     legend.title = element_text(colour = "#666666", size = 16, vjust = 0.75),
    legend.text = element_text(colour = "#666666", size = 8),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 8),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 16),
    axis.title.x = element_blank(),
    panel.background = element_rect(fill = "#FFFFFF", color = "#666666", size = 1, linetype = "solid"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  coord_flip() +
  scale_x_discrete(limits = rev(levels(as.factor(shootings_per_state_prior$Prior_Signs_Of_Mental_Health_Issues))))

# Display heatmap of shootings per state and whether there were prior signs of mental health issues
heatmap_state_prior
```

In most of the 35 states, **most** of the mass shooters had **prior signs** of mental health issues.   

Only 2 of the states (**5%**) have had more mass shootings with **no prior signs** of mental health issues.  
  
  
## Were Weapons Obtained Legally?

```{r create_legally_summary, include=FALSE}

# Create a new data frame that shows number of shootings based on whether the weapons were obtained legally or not
shootings_per_legally <- data.frame(table(cleansed_data$weapons_obtained_legally))

# Change the column heading names to "legally" and "shootings"
colnames(shootings_per_legally) <- c("weapons_obtained_legally", "shootings")
```

```{r display_plot_legally, echo=FALSE, fig.width=10, fig.height=5}

# Create a treemap chart for shootings involving legal and illegal weapons
treemap_legally_shootings <- ggplot(shootings_per_legally, aes(area = shootings, label = weapons_obtained_legally)) +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16))+
  geom_treemap(aes(alpha = shootings), fill = colour_palette[30]) +
  geom_treemap_text(colour = "white", place = "centre",
                    grow = TRUE)

# Display the treemap chart 
treemap_legally_shootings

```

**72%** of mass shooters obtained weapons **legally**.
  
  
## Shootings By Location Type

```{r create_loc_type_summary, include=FALSE}

# Create a new data frame that shows number of shootings by location type
shootings_per_loc_type <- data.frame(table(cleansed_data$location.1))

# Change the column heading names to "location.1" and "shootings"
colnames(shootings_per_loc_type) <- c("location.1", "shootings")
```

```{r display_plot_loc_type, echo=FALSE, fig.width=10, fig.height=5}

# Create a lollipop chart using ggplot2 to show number of shootings per location type
lollipop_loc_type <- ggplot(shootings_per_loc_type, aes(y = shootings, x=location.1)) +
  geom_segment( aes(x = location.1, xend=location.1, y=0, yend=shootings), 
                color = "#e0e1e2", 
                size = 2) +
  geom_point( size=15, 
              color="#e1ad46", 
              fill="#e1ad46", 
              shape=21
              ) +
  labs(y = "Number of mass shootings") +
  geom_text(aes(label=shootings),hjust=0.5, vjust=0.5, color = "#FFFFFF", size = 9) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 22),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 18),
    axis.title.x = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
    coord_cartesian(ylim=c(0,50))

# Display the chart
lollipop_loc_type

```
 

A **third** of US mass shootings occurred in a **workplace**.

**15%** occurred in a **school**.
  
    
    
## Location Type & Race

```{r create_loc_type_race_summary, include=FALSE}
# Create a new data frame that shows number by location type and race
shootings_per_loc_type_race <- aggregate(cleansed_data$for_count, by=list(cleansed_data$location.1, cleansed_data$race),FUN = sum)

# Change the column heading names to Location_Type, Race and Num_Shootings
colnames(shootings_per_loc_type_race) <- c("Location_Type", "Race", "Num_Shootings")
```

```{r display_plot_loc_type_race, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by location type and race
 plot_loc_type_race <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Location_Type, fill=Race), data = shootings_per_loc_type_race, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[20], colour_palette[45], colour_palette[60], colour_palette[75], colour_palette[85], colour_palette[95])) +
  labs(x = "Location Type",
       y = "% of mass shootings",
       fill = "Race") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))              

# Display the bar chart 
plot_loc_type_race

```

**All** 6 of the mass shootings in a **religious** place involved a shooter who was **white**

**Over half** of mass shootings in a **school** involved a shooter who was **white**.
    
    
## Age Of Shooter

```{r create_age_summary, include=FALSE}

# Create a new data frame that shows number of shootings by age
shootings_per_age <- data.frame(table(cleansed_data$age_of_shooter))

# Change the column heading names to "age" and "shootings"
colnames(shootings_per_age) <- c("age_of_shooter", "shootings")
```

```{r display_plot_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age
plot_age <- ggplot(shootings_per_age, aes(y=shootings, x=age_of_shooter)) + 
  geom_bar(position="dodge", stat="identity", fill = colour_palette[45]) +
  labs(x = "Age",
       y = "Number of mass shootings") +
  geom_text(aes(label=shootings), vjust = -0.5, size = 6, col = "#666666", fontface = "bold") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 12),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 18),
    axis.title.x = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm")) +
    coord_cartesian(ylim=c(0,8))

# Display the bar chart 
plot_age

```

Shooter ages ranged from **11** to **66**.
  
  
## Age Bracket Of Shooter

```{r create_age_bracket_column, include=FALSE}

# Create a new column called age_bracket and populate it with the age bracket of each shooter. 

cleansed_data$age_bracket <- case_when(
    cleansed_data$age_of_shooter <= 12 ~ "1-12",
    cleansed_data$age_of_shooter > 12 & cleansed_data$age_of_shooter < 20 ~ "13-19",
    cleansed_data$age_of_shooter >= 20 & cleansed_data$age_of_shooter < 30 ~ "20s",
    cleansed_data$age_of_shooter >= 30 & cleansed_data$age_of_shooter < 40 ~ "30s",
    cleansed_data$age_of_shooter >= 40 & cleansed_data$age_of_shooter < 50 ~ "40s",
    cleansed_data$age_of_shooter >= 50 & cleansed_data$age_of_shooter < 60 ~ "50s",
    cleansed_data$age_of_shooter >= 60 & cleansed_data$age_of_shooter < 70 ~ "60s"
)

```

```{r create_age_bracket_summary, include=FALSE}

# Create a new data frame that shows number of shootings by age bracket
shootings_per_age_bracket <- data.frame(table(cleansed_data$age_bracket))

# Change the column heading names to "age bracket" and "shootings"
colnames(shootings_per_age_bracket) <- c("age_bracket", "shootings")
```

```{r display_plot_age_bracket, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket
plot_age_bracket <- ggplot(shootings_per_age_bracket, aes(y=shootings, x=age_bracket)) + 
  geom_bar(position="dodge", stat="identity", fill = colour_palette[30]) +
  labs(x = "Age bracket",
       y = "Number of mass shootings") +
  geom_text(aes(label=shootings), vjust = -0.5, size = 8, col = "#666666", fontface = "bold") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 22),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 18),
    axis.title.x = element_blank(), 
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm")) +
    coord_cartesian(ylim=c(0,40))

# Display the bar chart 
plot_age_bracket

```

A **third** of mass shooters were in their **20s** (34% of mass shootings).
  
  
## Year & Age Bracket

```{r create_year_age_summary, include=FALSE}
# Create a new data frame that shows number by year and age bracket
shootings_per_year_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$year, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to Year, Age_Bracket and Num_Shootings
colnames(shootings_per_year_age) <- c("Year", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_year_age, echo=FALSE, fig.width=10, fig.height=5}
without_child_age_bracket <- shootings_per_year_age[shootings_per_year_age$Age_Bracket != "1-12", ]

# Create a faceted line graph showing the number of mass shootings per year for each age bracket
faceted_line_graph_year_age <- ggplot(data=without_child_age_bracket, aes(x=Year, y = Num_Shootings, colour = Age_Bracket, group=1)) + 
  labs(x = "Year", y="Number of Mass Shootings")+
  geom_line(size = 2)+
  geom_point()+
  scale_color_viridis_d(option = "magma", begin = 0.1, end = 0.85) +
  geom_smooth(method = "lm", colour = "#666666", linetype = 2, size = 0.5 )+
  theme(legend.position = "none", # Remove the legend
        strip.text.x = element_text(size = 22, colour = "#666666"), # Change the size of the facet titles
        axis.text = element_text(size = 18, colour = "#666666"), # Change the size of the axis numbers/years
        axis.title = element_text(size = 18, colour = "#666666"),
        panel.background = element_blank(), # Remove the grey background
        panel.grid.major = element_line(colour = "#e0e0e0"), # Add the major grid lines back in
        panel.grid.minor = element_line(colour = "#e0e0e0"),
    plot.margin=unit(c(1,0,1,0),"cm"))+ # Add the minor grid lines back in)
  facet_wrap(~Age_Bracket)

# Display the faceted line graph
faceted_line_graph_year_age 
  
```

There is a noticeable **increase** in recent years in the number of mass shooters in their **twenties**.

Note: The age bracket "1-12" has been excluded from the charts because there was only one instance in that category and so there is little use trying to illustrate the pattern over time for that age bracket.  
  
  
## Semi-Automatic Weapons

```{r create_semi_auto_used_column, include=FALSE}

# Create a new column called semi_auto_used and populate it with Yes or No depending on whether the shooter used a semi-automatic weapon

cleansed_data$semi_auto_used <- "No"

cleansed_data[grep("automatic", cleansed_data$weapon_type, ignore.case = TRUE), "semi_auto_used"] <- "Yes" 
```

```{r create_semi_summary, include=FALSE}

# Create a new data frame that shows number of shootings by whether semi automatic weapons were used
shootings_per_semi <- data.frame(table(cleansed_data$semi_auto_used))

# Change the column heading names to "semi automatic weapon used" and "shootings"
colnames(shootings_per_semi) <- c("semi_auto_used", "shootings")

# Add a Percentage column containing the % of shootings for each category (yes, no)
shootings_per_semi$percentage <- round(shootings_per_semi$shootings / sum(shootings_per_semi$shootings) * 100, 0)
```

```{r display_plot_semi_auto_used, echo=FALSE, fig.width=10, fig.height=2}

# Create a waffle chart
semi_auto_waffle <- waffle(c('Yes'=65, 'No'=35), rows = 4, colors = c('Yes'= colour_palette[70], 'No'=colour_palette[95]))

# Display the waffle chart
semi_auto_waffle

```

Almost **two thirds** (65%) of mass shootings involved **semi-automatic weapons**.
  
  
## State & Semi-Automatic Weapons

```{r create_state_semi_summary, include=FALSE}
# Create a new data frame that shows number by state and whether semi-automatic weapons were used
shootings_per_state_semi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$semi_auto_used),FUN = sum)

# Change the column heading names to State, Semi_Auto_Weapons_Used, and Num_Shootings
colnames(shootings_per_state_semi) <- c("State", "Semi_Auto_Weapons_Used", "Num_Shootings")

# Change the Num_Shootings values for "No" to negative numbers, so values for "No" are on the bottom and values for "Yes" are on the top
shootings_per_state_semi$Num_Shootings = case_when(
   shootings_per_state_semi$Semi_Auto_Weapons_Used == "No" ~ -shootings_per_state_semi$Num_Shootings,
   shootings_per_state_semi$Semi_Auto_Weapons_Used == "Yes" ~ shootings_per_state_semi$Num_Shootings
)
```

```{r display_plot_state_semi, echo=FALSE, fig.width=10, fig.height=5}

brks <- seq(-16, 16, 2) # X Axis Breaks
lbls = as.character(c(seq(16, 0, -2), seq(2, 16, 2))) # X Axis Labels

# Create a bar chart using ggplot2 to show shootings by state and whether semi-automatic weapons were used
 plot_state_semi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=State, fill=Semi_Auto_Weapons_Used), 
           data = shootings_per_state_semi, 
           stat = "identity") +
   scale_y_continuous(breaks = brks,   # Breaks
                     labels = lbls) + # Labels
   scale_fill_manual(values = c(colour_palette[95], colour_palette[50])) +
   labs(x = "State",
       y = "Number of mass shootings",
       fill = "Semi-Auto Weapons Used?") +
   theme(
     legend.position = "top",
     legend.title = element_text(colour = "#666666", size = 16),
     legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 8),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
   guides(fill = guide_legend(reverse = TRUE))

# Display the bar chart 
plot_state_semi
```

Of the 35 states that have had a mass shooting, 30 (**85%**) have had shootings involving semi-automatic weapons.  

For 14 states (**40%** of the states that have had mass shootings), for example Connecticut, **all** their mass shootings have involved semi-automatic weapons. 

In the 3 states with the most mass shootings - California, Florida and Texas - more shootings have involved semi-automatic weapons than without.

Only 5 states have not had any mass shootings with semi-automatic weapons.
  
  
## Decade & Semi-Automatic Weapons

```{r create_decade_semi_summary, include=FALSE}
# Create a new data frame that shows number by decade and whether semi-automatic weapons were used
shootings_per_decade_semi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$decade, cleansed_data$semi_auto_used),FUN = sum)

# Change the column heading names to Decade, Semi_Auto_Weapons_Used, and Num_Shootings
colnames(shootings_per_decade_semi) <- c("Decade", "Semi_Auto_Weapons_Used", "Num_Shootings")

```

```{r display_plot_decade_semi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bubble chart
bubble_decade_semi <- ggplot(shootings_per_decade_semi, aes(x=Decade, y=Num_Shootings, color = Semi_Auto_Weapons_Used)) +
  geom_point(alpha=0.7, size = 10)+
  scale_colour_manual(values = c(colour_palette[70], colour_palette[90]))+
  labs(x = "Decade",
       y = "Number of mass shootings",
       colour = "Semi-Auto Weapons Used?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    legend.key = element_rect(fill = NA, colour = NA),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    panel.grid.major = element_line(colour = "#e0e0e0"), # Add the major grid lines back in
    panel.grid.minor = element_line(colour = "#e0e0e0"),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  coord_cartesian(ylim=c(0,40))

# Display the bubble chart
bubble_decade_semi

```

In **every decade**, more mass shootings have involved semi-automatic weapons than without.
  
    
    
## Multiple Weapons

```{r create_multiple_weapons_used_column, include=FALSE}

# Create a new column called multiple_weapons_used and populate it with Yes or No depending on whether the shooter used more than one weapon

cleansed_data$multiple_weapons_used <- "No"

cleansed_data[grep("Two", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 

cleansed_data[grep("Three", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 

cleansed_data[grep("Five", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes"

cleansed_data[grep(" and ", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 

cleansed_data[grep(",", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 

cleansed_data[grep(";", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 

cleansed_data[grep("rifles", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 
```

```{r create_multiple_weapons_summary, include=FALSE}

# Create a new data frame that shows number of shootings by whether multiple weapons were used
shootings_per_multiple <- data.frame(table(cleansed_data$multiple_weapons_used))

# Change the column heading names to "multiple weapon used" and "shootings"
colnames(shootings_per_multiple) <- c("multiple_weapons_used", "shootings")

# Add a Percentage column containing the % of shootings for each category (yes, no)
shootings_per_multiple$percentage <- round(shootings_per_multiple$shootings / sum(shootings_per_multiple$shootings) * 100, 0)

```

```{r display_plot_multiple_weapons_used, echo=FALSE, fig.width=10, fig.height=2}

# Create a waffle chart
multiple_weapons_waffle <- waffle(c('Yes'=53, 'No'=47), rows = 4, colors = c('Yes'= colour_palette[20], 'No'=colour_palette[55]))

# Display the waffle chart
multiple_weapons_waffle
```

Just **over half** (53%) of mass shootings involved **multiple weapons**.
  
    
# Other Visualisations  

## State & Decade 

```{r create_decade_state_summary, include=FALSE}

# Create a new data frame that shows number of shootings per decade per state
shootings_per_decade_state <- aggregate(cleansed_data$for_count, by=list(cleansed_data$decade, cleansed_data$state),FUN = sum)

# Change the column heading names to "decade", "state", shootings"
colnames(shootings_per_decade_state) <- c("decade", "state", "shootings")
```

```{r display_plot_decade_state, echo=FALSE, fig.height=7, fig.width=10}

# Create a heatmap showing the number of mass shootings per decade per state
heatmap_decade_state <- ggplot(shootings_per_decade_state, aes(decade, state)) + 
  geom_tile(aes(fill = shootings), colour = "white") + 
  scale_fill_gradient(low = colour_palette[50], high = colour_palette[20])+
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16, vjust = 0.75),
    legend.text = element_text(colour = "#666666", size = 10),
    axis.text.y = element_text(colour = "#666666", size = 12),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 18),
    axis.title.x = element_blank(),
    panel.background = element_rect(fill = "#FFFFFF", color = "#666666", size = 1, linetype = "solid"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  scale_y_discrete(position = "right", 
                   # Re-order the states so "AR"" is at the top rather than the bottom of the y axis
                   limits = rev(levels(as.factor(shootings_per_decade_state$state))))

# Display heatmap of shootings per decade and state
heatmap_decade_state
```
  
  
## State & Multiple Weapons

```{r create_state_multi_summary, include=FALSE}
# Create a new data frame that shows number by state and whether multiple weapons were used
shootings_per_state_multi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$multiple_weapons_used),FUN = sum)

# Change the column heading names to State, Multiple_Weapons_Used, and Num_Shootings
colnames(shootings_per_state_multi) <- c("State", "Multiple_Weapons_Used", "Num_Shootings")

# Change the Num_Shootings values for "No" to negative numbers, so values for "No" are on the bottom and values for "Yes" are on the top
shootings_per_state_multi$Num_Shootings = case_when(
   shootings_per_state_multi$Multiple_Weapons_Used == "No" ~ -shootings_per_state_multi$Num_Shootings,
   shootings_per_state_multi$Multiple_Weapons_Used == "Yes" ~ shootings_per_state_multi$Num_Shootings
)
```

```{r display_plot_state_multi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by state and whether multiple weapons were used
 plot_state_multi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=State, fill=Multiple_Weapons_Used), data = shootings_per_state_multi, stat = "identity") +
  scale_y_continuous(breaks = brks,   # Breaks
                     labels = lbls) + # Labels
  scale_fill_manual(values = c(colour_palette[65], colour_palette[25])) +
  labs(x = "State",
       y = "Number of mass shootings",
       fill = "Multiple Weapons Used?") +
  theme(
    legend.position = "top",
     legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 8),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
   guides(fill = guide_legend(reverse = TRUE))

# Display the bar chart 
plot_state_multi

```
   
   
## State & Race

```{r create_state_race_summary, include=FALSE}
# Create a new data frame that shows number of shootings by state and race
shootings_per_state_race <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$race),FUN = sum)

# Change the column heading names to State, Race and Num_Shootings
colnames(shootings_per_state_race) <- c("State", "Race", "Num_Shootings")

```

```{r display_plot_state_race, echo=FALSE, fig.width=10, fig.height=5}

# Create a heatmap showing the number of mass shootings per state per race
heatmap_state_race <- ggplot(shootings_per_state_race, aes(Race, State)) + 
  geom_tile(aes(fill = Num_Shootings), colour = "white") + 
  scale_fill_gradient(low = "#f2b698", high = "#e56222")+
  geom_text(aes(label=Num_Shootings), hjust=0.5, vjust=0.5, color = "#FFFFFF", size = 4) +
  labs(fill = "Number of Shootings")+
  theme(
    legend.position = "top",
     legend.title = element_text(colour = "#666666", size = 16, vjust = 0.75),
    legend.text = element_text(colour = "#666666", size = 8),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 8),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 16),
    axis.title.x = element_blank(),
    panel.background = element_rect(fill = "#FFFFFF", color = "#666666", size = 1, linetype = "solid"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  coord_flip() +
  scale_x_discrete(limits = rev(levels(as.factor(shootings_per_state_race$Race))))

# Display heatmap of shootings per race and state
heatmap_state_race

```


  
  
## State & Weapons Obtained Legally

```{r create_state_legally_summary, include=FALSE}
# Create a new data frame that shows number by state and whether weapons were obtained legally
shootings_per_state_legally <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$weapons_obtained_legally),FUN = sum)

# Change the column heading names to State, Weapons_Obtained_Legally, and Num_Shootings
colnames(shootings_per_state_legally) <- c("State", "Weapons_Obtained_Legally", "Num_Shootings")
```

```{r display_plot_state_legally, echo=FALSE, fig.width=10, fig.height=5}

# Create a heatmap showing the number of mass shootings per state per race
heatmap_state_legally <- ggplot(shootings_per_state_legally, aes(Weapons_Obtained_Legally, State)) + 
  geom_tile(aes(fill = Num_Shootings), colour = "white") + 
  scale_fill_gradient(low = "#eda097", high = "#d63d2c")+
  geom_text(aes(label=Num_Shootings), hjust=0.5, vjust=0.5, color = "#FFFFFF", size = 4) +
  labs(x = "Weapons Obtained Legally?", fill = "Number of Shootings")+
  theme(
    legend.position = "top",
     legend.title = element_text(colour = "#666666", size = 16, vjust = 0.75),
    legend.text = element_text(colour = "#666666", size = 8),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 8),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 16),
    axis.title.x = element_blank(),
    panel.background = element_rect(fill = "#FFFFFF", color = "#666666", size = 1, linetype = "solid"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  coord_flip() +
  scale_x_discrete(limits = rev(levels(as.factor(shootings_per_state_legally$Weapons_Obtained_Legally))))

# Display heatmap of shootings per state and whether weapons were obtained legally
heatmap_state_legally

```  

  
  
## State & Location Type

```{r create_state_loc_type_summary, include=FALSE}
# Create a new data frame that shows number by state and location type
shootings_per_state_loc_type <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$location.1),FUN = sum)

# Change the column heading names to State, Location_Type and Num_Shootings
colnames(shootings_per_state_loc_type) <- c("State", "Location_Type", "Num_Shootings")
```

```{r display_plot_state_loc_type, echo=FALSE, fig.width=10, fig.height=5}

# Create a heatmap showing the number of mass shootings per state per location type
heatmap_state_loc_type <- ggplot(shootings_per_state_loc_type, aes(Location_Type, State)) + 
  geom_tile(aes(fill = Num_Shootings), colour = "white") + 
  scale_fill_gradient(low = "#ddadb8", high = "#c9264f")+
  geom_text(aes(label=Num_Shootings), hjust=0.5, vjust=0.5, color = "#FFFFFF", size = 4) +
  labs(x = "Location Type", fill = "Number of Shootings")+
  theme(
    legend.position = "top",
     legend.title = element_text(colour = "#666666", size = 16, vjust = 0.75),
    legend.text = element_text(colour = "#666666", size = 8),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 8),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 16),
    axis.title.x = element_blank(),
    panel.background = element_rect(fill = "#FFFFFF", color = "#666666", size = 1, linetype = "solid"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  coord_flip() +
  scale_x_discrete(limits = rev(levels(as.factor(shootings_per_state_loc_type$Location_Type))))

# Display heatmap of shootings per state and location type
heatmap_state_loc_type

```
  
  
## State & Age Bracket

```{r create_state_age_summary, include=FALSE}
# Create a new data frame that shows number by state and age bracket
shootings_per_state_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to State, Age_Bracket and Num_Shootings
colnames(shootings_per_state_age) <- c("State", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_state_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a heatmap showing the number of mass shootings per state and age bracket
heatmap_state_age<- ggplot(shootings_per_state_age, aes(Age_Bracket, State)) + 
  geom_tile(aes(fill = Num_Shootings), colour = "white") + 
  scale_fill_gradient(low = "#d4aee5", high = colour_palette[30])+
  geom_text(aes(label=Num_Shootings), hjust=0.5, vjust=0.5, color = "#FFFFFF", size = 4) +
  labs(x = "Age Bracket", fill = "Number of Shootings")+
  theme(
    legend.position = "top",
     legend.title = element_text(colour = "#666666", size = 16, vjust = 0.75),
    legend.text = element_text(colour = "#666666", size = 8),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 8),
    axis.ticks = element_blank(),
    axis.title.y = element_text(colour = "#666666", size = 16),
    axis.title.x = element_blank(),
    panel.background = element_rect(fill = "#FFFFFF", color = "#666666", size = 1, linetype = "solid"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  coord_flip() 

# Display heatmap of shootings per state and age bracket
heatmap_state_age

```

  
  
## Decade & Multiple Weapons

```{r create_decade_multi_summary, include=FALSE}
# Create a new data frame that shows number by decade and whether multiple weapons were used
shootings_per_decade_multi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$decade, cleansed_data$multiple_weapons_used),FUN = sum)

# Change the column heading names to Decade, Multiple_Weapons_Used, and Num_Shootings
colnames(shootings_per_decade_multi) <- c("Decade", "Multiple_Weapons_Used", "Num_Shootings")
```

```{r display_plot_decade_multi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bubble chart
bubble_decade_multi <- ggplot(shootings_per_decade_multi, aes(x=Decade, y=Num_Shootings, color = Multiple_Weapons_Used)) +
  geom_point(alpha=0.7, size = 10)+
  scale_colour_manual(values = c(colour_palette[25], colour_palette[55]))+
  labs(x = "Decade",
       y = "Number of mass shootings",
       colour = "Multiple Weapons Used?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    legend.key = element_rect(fill = NA, colour = NA),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    panel.grid.major = element_line(colour = "#e0e0e0"), # Add the major grid lines back in
    panel.grid.minor = element_line(colour = "#e0e0e0"),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  coord_cartesian(ylim=c(0,40))

# Display the bubble chart
bubble_decade_multi

```

  
  
## Decade & Prior Signs of Mental Health Issues

```{r create_decade_prior_summary, include=FALSE}
# Create a new data frame that shows number by decade and whether there were prior signs of mental health issues
shootings_per_decade_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$decade, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Decade, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_decade_prior) <- c("Decade", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_decade_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bubble chart
bubble_decade_prior <- ggplot(shootings_per_decade_prior, aes(x=Decade, y=Num_Shootings, color = Prior_Signs_Of_Mental_Health_Issues)) +
  geom_point(alpha=0.7, size = 10)+
  scale_colour_manual(values = c(colour_palette[90], colour_palette[65], colour_palette[40]))+
  labs(x = "Decade",
       y = "Number of mass shootings",
       colour = "Prior Signs of Mental Health Issues?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    legend.key = element_rect(fill = NA, colour = NA),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    panel.grid.major = element_line(colour = "#e0e0e0"), # Add the major grid lines back in
    panel.grid.minor = element_line(colour = "#e0e0e0"),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  coord_cartesian(ylim=c(0,40))

# Display the bubble chart
bubble_decade_prior

```  
  
  
## Decade & Weapons Obtained Legally

```{r create_decade_legally_summary, include=FALSE}
# Create a new data frame that shows number by decade and whether weapons were obtained legally
shootings_per_decade_legally <- aggregate(cleansed_data$for_count, by=list(cleansed_data$decade, cleansed_data$weapons_obtained_legally),FUN = sum)

# Change the column heading names to Decade, Weapons_Obtained_Legally, and Num_Shootings
colnames(shootings_per_decade_legally) <- c("Decade", "Weapons_Obtained_Legally", "Num_Shootings")
```

```{r display_plot_decade_legally, echo=FALSE, fig.width=10, fig.height=5}

# Create a bubble chart
bubble_decade_legally <- ggplot(shootings_per_decade_legally, aes(x=Decade, y=Num_Shootings, color = Weapons_Obtained_Legally)) +
  geom_point(alpha=0.7, size = 10)+
  scale_colour_manual(values = c(colour_palette[20], colour_palette[55], colour_palette[80]))+
  labs(x = "Decade",
       y = "Number of mass shootings",
       colour = "Weapons Obtained Legally?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    legend.key = element_rect(fill = NA, colour = NA),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    panel.grid.major = element_line(colour = "#e0e0e0"), # Add the major grid lines back in
    panel.grid.minor = element_line(colour = "#e0e0e0"),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  coord_cartesian(ylim=c(0,50))

# Display the bubble chart
bubble_decade_legally

```  
  
  
## Decade & Location Type

```{r create_decade_loc_type_summary, include=FALSE}
# Create a new data frame that shows number by decade and location type
shootings_per_decade_loc_type <- aggregate(cleansed_data$for_count, by=list(cleansed_data$decade, cleansed_data$location.1),FUN = sum)

# Change the column heading names to Decade, Location_Type and Num_Shootings
colnames(shootings_per_decade_loc_type) <- c("Decade", "Location_Type", "Num_Shootings")
```

```{r display_plot_decade_loc_type, echo=FALSE, fig.width=10, fig.height=5}

# Create a bubble chart
bubble_decade_loc_type <- ggplot(shootings_per_decade_loc_type, aes(x=Decade, y=Num_Shootings, color = Location_Type)) +
  geom_point(alpha=0.7, size = 10)+
  scale_colour_manual(values = c(colour_palette[5],colour_palette[20], colour_palette[47], colour_palette[69], colour_palette[83], colour_palette[95]))+
  labs(x = "Decade",
       y = "Number of mass shootings",
       colour = "Location Type") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    legend.key = element_rect(fill = NA, colour = NA),
    axis.text.y = element_text(colour = "#666666", size = 16),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    panel.grid.major = element_line(colour = "#e0e0e0"), # Add the major grid lines back in
    panel.grid.minor = element_line(colour = "#e0e0e0"),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))+
  coord_cartesian(ylim=c(0,40))

# Display the bubble chart
bubble_decade_loc_type

```
  
  
## Semi-Automatic Weapons & Prior Signs of Mental Health Issues

```{r create_semi_prior_summary, include=FALSE}
# Create a new data frame that shows number by whether there were prior signs of mental health issues and whether semi-automatic weapons were used
shootings_per_semi_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$semi_auto_used, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Semi_Auto_Used, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_semi_prior) <- c("Semi_Auto_Used", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_semi_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental health issues and whether a semi-automatic weapon was used
 plot_semi_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Semi_Auto_Used, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_semi_prior, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[60], colour_palette[75], colour_palette[90])) +
  labs(x = "Semi Automatic Weapons Used?",
       y = "% of mass shootings",
       fill = "Prior Signs of Mental Health Issues?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))  

# Display the bar chart 
plot_semi_prior

```  
  
  
## Multiple Weapons & Prior Signs of Mental Health Issues

```{r create_multi_prior_summary, include=FALSE}
# Create a new data frame that shows number by whether there were prior signs of mental health issues and whether multiple weapons were used
shootings_per_multi_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$multiple_weapons_used, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Multiple_Weapons_Used, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_multi_prior) <- c("Multiple_Weapons_Used", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_multi_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental health issues and whether multiple weapons were used
 plot_multi_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Multiple_Weapons_Used, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_multi_prior, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[30], colour_palette[40], colour_palette[50])) +
  labs(x = "Multiple Weapons Used?",
       y = "% of mass shootings",
       fill = "Prior Signs of Mental Health Issues?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))   

# Display the bar chart 
plot_multi_prior

```  
  
  
## Age Bracket & Prior Signs of Mental Health Issues

```{r create_age_prior_summary, include=FALSE}
# Create a new data frame that shows number by whether there were prior signs of mental health issues and age bracket
shootings_per_age_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$age_bracket, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Age_Bracket, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_age_prior) <- c("Age_Bracket", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_age_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental health issues and age bracket
 plot_age_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Age_Bracket, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_age_prior, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[60], colour_palette[75], colour_palette[90])) +
  labs(x = "Age Bracket",
       y = "% of mass shootings",
       fill = "Prior Signs of Mental Health Issues?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))         

# Display the bar chart 
plot_age_prior

```  
  
  
## Weapons Obtained Legally & Prior Signs of Mental Health Issues

```{r create_legally_prior_summary, include=FALSE}
# Create a new data frame that shows number by whether there were prior signs of mental health issues and whether weapons were obtained legally
shootings_per_legally_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$weapons_obtained_legally, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Weapons_Obtained_Legally, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_legally_prior) <- c("Weapons_Obtained_Legally", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_legally_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental health issues and whether weapons were obtained legally
 plot_legally_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Weapons_Obtained_Legally, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_legally_prior, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[30], colour_palette[40], colour_palette[50])) +
  labs(x = "Weapons Obtained Legally?",
       y = "% of mass shootings",
       fill = "Prior Signs of Mental Health Issues") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))           

# Display the bar chart 
plot_legally_prior

```  
  
  
## Location Type & Prior Signs of Mental Health Issues

```{r create_loc_type_prior_summary, include=FALSE}
# Create a new data frame that shows number by whether there were prior signs of mental health issues and location type
shootings_per_loc_type_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$location.1, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Location_Type, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_loc_type_prior) <- c("Location_Type", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_loc_type_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental health issues and location type
 plot_loc_type_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Location_Type, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_loc_type_prior, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[30], colour_palette[60], colour_palette[90])) +
  labs(x = "Location Type",
       y = "% of mass shootings",
       fill = "Prior Signs of Mental Health Issues?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))          

# Display the bar chart 
plot_loc_type_prior

```  
  
  
## Semi-Automatic Weapons & Multiple Weapons

```{r create_multi_semi_summary, include=FALSE}
# Create a new data frame that shows number by whether semi-automatic weapons were used and whether multiple weapons were used
shootings_per_multi_semi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$multiple_weapons_used, cleansed_data$semi_auto_used),FUN = sum)

# Change the column heading names to Multiple_Weapons_Used, Semi_Auto_Used, and Num_Shootings
colnames(shootings_per_multi_semi) <- c("Multiple_Weapons_Used", "Semi_Auto_Used", "Num_Shootings")
```

```{r display_plot_multi_semi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were semi-automatic weapons used and whether multiple weapons were used
 plot_multi_semi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Multiple_Weapons_Used, fill=Semi_Auto_Used), data = shootings_per_multi_semi, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[70], colour_palette[90])) +
  labs(x = "Multiple Weapons Used?",
       y = "% of mass shootings",
       fill = "Semi-Auto Weapons Used?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))    

# Display the bar chart 
plot_multi_semi

```  
  
  
## Semi-Automatic Weapons & Weapons Obtained Legally

```{r create_semi_legally_summary, include=FALSE}
# Create a new data frame that shows number by whether weapons were obtained legally and whether semi-automatic weapons were used
shootings_per_semi_legally <- aggregate(cleansed_data$for_count, by=list(cleansed_data$semi_auto_used, cleansed_data$weapons_obtained_legally),FUN = sum)

# Change the column heading names to Semi_Auto_Used, Weapons_Obtained_Legally and Num_Shootings
colnames(shootings_per_semi_legally) <- c("Semi_Auto_Used", "Weapons_Obtained_Legally", "Num_Shootings")
```

```{r display_plot_semi_legally, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether weapons were obtained legally and whether semi-automatic weapons were used
 plot_semi_legally <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Weapons_Obtained_Legally, fill=Semi_Auto_Used), data = shootings_per_semi_legally, stat = "identity", position = "fill") +
  scale_fill_manual(values = c('Yes'= colour_palette[20], 'No'=colour_palette[45])) +
  labs(x = "Weapons Obtained Legally?",
       y = "% of mass shootings",
       fill = "Semi-Auto Weapons Used?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))        

# Display the bar chart 
plot_semi_legally

```
  
  
## Semi-Automatic Weapons & Age Bracket

```{r create_semi_age_summary, include=FALSE}
# Create a new data frame that shows number by age bracket and whether semi-automatic weapons were used
shootings_per_semi_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$semi_auto_used, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to Semi_Auto_Used, Age_Bracket and Num_Shootings
colnames(shootings_per_semi_age) <- c("Semi_Auto_Used", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_semi_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket and whether semi-automatic weapons were used
 plot_semi_age <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Semi_Auto_Used, fill=Age_Bracket), data = shootings_per_semi_age, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[10], colour_palette[30], colour_palette[50], colour_palette[65], colour_palette[80], colour_palette[90], colour_palette[100])) +
  labs(x = "Semi Automatic Weapons Used?",
       y = "% of mass shootings",
       fill = "Age Bracket") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))     

# Display the bar chart 
plot_semi_age

```
  
  
## Semi Automatic Weapons & Location Type

```{r create_loc_type_semi_summary, include=FALSE}
# Create a new data frame that shows number by location type and whether semi-automatic weapons were used
shootings_per_loc_type_semi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$location.1, cleansed_data$semi_auto_used),FUN = sum)

# Change the column heading names to Location_Type, Semi_Auto_Used and Num_Shootings
colnames(shootings_per_loc_type_semi) <- c("Location_Type", "Semi_Auto_Used", "Num_Shootings")
```

```{r display_plot_loc_type_semi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by location type and whether semi-automatic weapons were used
 plot_loc_type_semi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Location_Type, fill=Semi_Auto_Used), data = shootings_per_loc_type_semi, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[70], colour_palette[90])) +
  labs(x = "Location Type",
       y = "% of mass shootings",
       fill = "Semi-Auto Weapons Used?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))            

# Display the bar chart 
plot_loc_type_semi

```
  
  
## Age Bracket & Race

```{r create_age_race_summary, include=FALSE}
# Create a new data frame that shows number by age bracket and race
shootings_per_age_race <- aggregate(cleansed_data$for_count, by=list(cleansed_data$age_bracket, cleansed_data$race),FUN = sum)

# Change the column heading names to Age_Bracket, Race and Num_Shootings
colnames(shootings_per_age_race) <- c("Age_Bracket", "Race", "Num_Shootings")
```

```{r display_plot_age_race, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket and race
 plot_age_race <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Age_Bracket, fill=Race), data = shootings_per_age_race, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(c(colour_palette[20], colour_palette[30], colour_palette[45], colour_palette[60], colour_palette[75], colour_palette[90]))) +
  labs(x = "Age Bracket",
       y = "% of mass shootings",
       fill = "Race") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))              

# Display the bar chart 
plot_age_race

```
  
  
## Age Bracket & Location Type

```{r create_loc_type_age_summary, include=FALSE}
# Create a new data frame that shows number by age bracket and location type
shootings_per_loc_type_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$location.1, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to Location_Type, Age_Bracket and Num_Shootings
colnames(shootings_per_loc_type_age) <- c("Location_Type", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_loc_type_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket and location type
 plot_loc_type_age <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Location_Type, fill=Age_Bracket), data = shootings_per_loc_type_age, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[10], colour_palette[27], colour_palette[40], colour_palette[55], colour_palette[70], colour_palette[80], colour_palette[90])) +
  labs(x = "Location Type",
       y = "% of mass shootings",
       fill = "Age Bracket") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))           

# Display the bar chart 
plot_loc_type_age

```
  
  
## Age Bracket & Weapons Obtained Legally

```{r create_legally_age_summary, include=FALSE}
# Create a new data frame that shows number by age bracket and whether weapons were obtained legally
shootings_per_legally_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$weapons_obtained_legally, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to Weapons_Obtained_Legally, Age_Bracket and Num_Shootings
colnames(shootings_per_legally_age) <- c("Weapons_Obtained_Legally", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_legally_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket and whether weapons were obtained legally
 plot_legally_age <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Age_Bracket, fill=Weapons_Obtained_Legally), data = shootings_per_legally_age, stat = "identity", position = "fill") +
  scale_fill_manual(values = c( colour_palette[60], colour_palette[75], colour_palette[90])) +
  labs(x = "Age Bracket",
       y = "% of mass shootings",
       fill = "Weapons Obtained Legally?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))      

# Display the bar chart 
plot_legally_age

```
  
  
## Age Bracket & Multiple Weapons

```{r create_multi_age_summary, include=FALSE}
# Create a new data frame that shows number by age bracket and whether multiple weapons were used
shootings_per_multi_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$multiple_weapons_used, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to Multiple_Weapons_Used, Age_Bracket and Num_Shootings
colnames(shootings_per_multi_age) <- c("Multiple_Weapons_Used", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_multi_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket and whether multiple weapons were used
 plot_multi_age <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Age_Bracket, fill=Multiple_Weapons_Used), data = shootings_per_multi_age, stat = "identity", position = "fill") +
  scale_fill_manual(values = c('Yes'= colour_palette[20], 'No'=colour_palette[45])) +
  labs(x = "Age Bracket",
       y = "% of mass shootings",
       fill = "Multiple Weapons Used?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))       

# Display the bar chart 
plot_multi_age

```
  
  
## Multiple Weapons & Weapons Obtained Legally

```{r create_multi_legally_summary, include=FALSE}
# Create a new data frame that shows number by whether weapons were obtained legally and whether multiple weapons were used
shootings_per_multi_legally <- aggregate(cleansed_data$for_count, by=list(cleansed_data$multiple_weapons_used, cleansed_data$weapons_obtained_legally),FUN = sum)

# Change the column heading names to Multiple_Weapons_Used, Weapons_Obtained_Legally and Num_Shootings
colnames(shootings_per_multi_legally) <- c("Multiple_Weapons_Used", "Weapons_Obtained_Legally", "Num_Shootings")
```

```{r display_plot_multi_legally, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether weapons were obtained legally and whether multiple weapons were used
 plot_multi_legally <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Weapons_Obtained_Legally, fill=Multiple_Weapons_Used), data = shootings_per_multi_legally, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[60], colour_palette[90])) +
  labs(x = "Weapons Obtained Legally?",
       y = "% of mass shootings",
       fill = "Multiple Weapons Used?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))       

# Display the bar chart 
plot_multi_legally

```
  
  
## Location Type & Multiple Weapons

```{r create_loc_type_multi_summary, include=FALSE}
# Create a new data frame that shows number by location type and whether multiple weapons were used
shootings_per_loc_type_multi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$location.1, cleansed_data$multiple_weapons_used),FUN = sum)

# Change the column heading names to Location_Type, Multiple_Weapons_Used and Num_Shootings
colnames(shootings_per_loc_type_multi) <- c("Location_Type", "Multiple_Weapons_Used", "Num_Shootings")
```

```{r display_plot_loc_type_multi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by location type and whether multiple weapons were used
 plot_loc_type_multi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Location_Type, fill=Multiple_Weapons_Used), data = shootings_per_loc_type_multi, stat = "identity", position = "fill") +
  scale_fill_manual(values = c(colour_palette[20], colour_palette[45])) +
  labs(x = "Location Type",
       y = "% of mass shootings",
       fill = "Multiple Weapons Used?") +
  theme(
    legend.position = "top",
    legend.title = element_text(colour = "#666666", size = 16),
    legend.text = element_text(colour = "#666666", size = 16),
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 16),
    axis.title = element_text(colour = "#666666", size = 16),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666"),
    plot.margin=unit(c(1,0,1,0),"cm"))             

# Display the bar chart 
plot_loc_type_multi

```
  
  
# Data Cleanse  

## Gender

The original breakdown of number of mass shootings by gender was:

```{r cleanse_data_gender_before, echo=FALSE}

# Create a data frame containing the unique list of genders in the original data, and the number of mass shootings by each
unique_genders <- data.frame(table(imported_data$gender))

# Change the column heading names to "Gender" and "Shootings"
colnames(unique_genders) <- c("Gender", "Shootings")

# Display the values for gender, and the total shootings for each, in the imported data in a table
kable(unique_genders)
```

The cleansed breakdown is:  

```{r cleanse_data_gender_after, echo=FALSE}

# Create a data frame containing the unique list of genders in the cleansed data, and the number of mass shootings by each
unique_genders <- data.frame(table(cleansed_data$gender))

# Change the column heading names to "Gender" and "Shootings"
colnames(unique_genders) <- c("Gender", "Shootings")

# View the values for gender, and the total shootings for each, in the cleansed data:
kable(unique_genders)
```
  
  
  
## Race

The original breakdown of number of mass shootings by race was:

```{r cleanse_data_race_before, echo=FALSE}

# Create a data frame containing the unique list of race values in the original data, and the number of mass shootings by each
unique_races <- data.frame(table(imported_data$race))

# Change the column heading names to "Race" and "Shootings"
colnames(unique_races) <- c("Race", "Shootings")

# Display the values for race, and the total shootings for each, in the imported data:
kable(unique_races)
```

The cleansed breakdown is:
```{r cleanse_data_race_after, echo=FALSE}

# Create a data frame containing the unique list of race values in the cleansed data, and the number of mass shootings by each
unique_races <- data.frame(table(cleansed_data$race))

# Change the column heading names to "Race" and "Shootings"
colnames(unique_races) <- c("Race", "Shootings")

# View the values for race, and the total shootings for each, in the cleansed data:
kable(unique_races)
```  
  
  
## Weapons Obtained Legally

The original breakdown of number of mass shootings by "Weapons Obtained Legally" was:

```{r cleanse_data_legally_before, echo=FALSE}

# Create a data frame containing the unique list of weapons_obtained_legally values in the original data, and the number of mass shootings by each
unique_legally <- data.frame(table(imported_data$weapons_obtained_legally))

# Change the column heading names to "Weapons Obtained Legally" and "Shootings"
colnames(unique_legally) <- c("Weapons Obtained Legally", "Shootings")

# Display the values for "Weapons Obtained Legally", and the total shootings for each, in the imported data:
kable(unique_legally)
```

The cleansed breakdown is:
```{r cleanse_data_legally_after, echo=FALSE}

# Create a data frame containing the unique list of weapons_obtained_legally values in the cleansed data, and the number of mass shootings by each
unique_legally <- data.frame(table(cleansed_data$weapons_obtained_legally))

# Change the column heading names to "Weapons Obtained Legally" and "Shootings"
colnames(unique_legally) <- c("Weapons Obtained Legally", "Shootings")

# View the values for "Weapons Obtained Legally", and the total shootings for each, in the cleansed data. Should have No 16, Unknown 15, Yes 79 Yes:
kable(unique_legally)
```
  
  
  
## State

A new column was added containing the state code e.g. CA for California.

In the original data, the unique states after the comma in the location column were:

```{r cleanse_data_state_before, echo=FALSE}

# Create a data frame containing unique states in the imported data (by extracting the text after the comma in the location column) and the number of mass shootings for each:
unique_state <- data.frame(table(sub('.*\\,', '', cleansed_data$location)))

# Change the column heading names to "State" and "Shootings"
colnames(unique_state) <- c("State", "Shootings")

# Display them
kable(unique_state)
```

After cleansing, the unique states are:

```{r cleanse_data_state_after, echo=FALSE}

# Create a data frame containing unique states in the cleansed data and the number of mass shootings for each:
unique_state <- data.frame(table(cleansed_data$state))

# Change the column heading names to "State" and "Shootings"
colnames(unique_state) <- c("State", "Shootings")

# Display the new unique list of states
kable(unique_state)

```  
  
  
## Location Type

The location types were:

```{r cleanse_data_loc_type_before, echo=FALSE}

# Create a data frame containing unique location types in the imported data and the number of mass shootings for each
unique_loc_type <- data.frame(table(imported_data$location.1))

# Change the column heading names to "Location Type" and "Shootings"
colnames(unique_loc_type) <- c("Location Type", "Shootings")

# Display the number of shootings per location type as per the values of location type in the imported data
kable(unique_loc_type)

```

There were 2 instances of "Workplace"" as one had a leading white space.

There were also 2 instaces of "Other"" as one with a trailing white space.

The cleansed types are:

```{r cleanse_data_loc_type_after, echo=FALSE}

# Create a data frame containing unique location types in the cleansed data and the number of mass shootings for each:
unique_loc_type <- data.frame(table(cleansed_data$location.1))

# Change the column heading names to "Location Type" and "Shootings"
colnames(unique_loc_type) <- c("Location Type", "Shootings")

# Display the new unique list of states
kable(unique_loc_type)
```  
  
  
## Prior Signs Of Mental Health Issues

The values in the imported data were:

```{r cleanse_data_prior_before, echo=FALSE}

# Create a data frame containing values for prior_signs_mental_health_issues in the imported data and the number of mass shootings for each
unique_prior <- data.frame(table(imported_data$prior_signs_mental_health_issues))

# Change the column heading names to "Prior Signs Of Mental health Issues" and "Shootings"
colnames(unique_prior) <- c("Prior Signs Of Mental Health Issues", "Shootings")

# Display the number of shootings per value for prior_signs_mental_health_issues 
kable(unique_prior)

```

The values are now:

```{r cleanse_data_prior_after, echo=FALSE}

# Create a data frame containing unique values for prior_signs_mental_health_issues in the cleansed data and the number of mass shootings for each
unique_prior <- data.frame(table(cleansed_data$prior_signs_mental_health_issues))

# Change the column heading names to "Prior Signs Of Mental Health Issues" and "Shootings"
colnames(unique_prior) <- c("Prior Signs Of Mental Health Issues", "Shootings")

# Display the table of number of shootings per value for prior_signs_mental_health_issues
kable(unique_prior)

```  

